<html>
<META HTTP-EQUIV="EXPIRES" CONTENT="0">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162432647-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-162432647-1');
  </script>

  <meta charset="UTF-8">
  <meta property="og:type" content="website" />
  <meta property="og:image" content="http://chrisbillington.net/COVID_NZ.png">
  <meta property="og:title" content="Progression of the COVID outbreak in New Zealand"/>
  <meta property="og:description" content="Plot of cases and estimated R_eff for the COVID outbreak in New Zealand"/>
  <meta property="og:url" content="http://chrisbillington.net/COVID_NZ.html">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="content">

    <div id="nav">
      <table>
        <tr>
          <th>Australia and New Zealand COVID outbreaks</th>
          <th>Other pages</th>
        </tr>
        <tr>
          <td>
            <li><a href="aus_vaccinations.html">Australian vaccination rollout</a></li>
            <li><a href="COVID_NSW.html">New South Wales</a></li>
            <li><a href="COVID_VIC_2021.html">Victoria</a></li>
            <li><a href="COVID_QLD.html">Queensland</a></li>
            <li><a href="COVID_SA.html">South Australia</a></li>
            <li><a href="COVID_ACT.html">Australian Capital Territory</a></li>
            <li><a href="COVID_NZ.html">New Zealand</a></li>
            <li><a href="COVID_VIC.html">Victoria 2020 (old 2nd wave plots)</a></li>
          </td>
          <td>
            <li><a href="COVID.html">Per-country COVID plots</a></li>
            <li><a href="COVID_US.html">USA per-state COVID plots</a></li>
          </td>
        </tr>
      </table>
    </div>

    <h1>
      Progression of the COVID outbreak in New Zealand
    </h1>
    Last updated: 2021-12-21 13:16 NZ time
    <br>
    <small>
      Updates daily near 1pm NZDT
    </small>
    <br>
    <br>
    <div id="toc_container">
      <p class="toc_title">Contents</p>
      <li><a href="#all"><i>R</i><sub>eff</sub> estimate from all cases</a></li>
      <li><a href="#sir">SIR model projection</a></li>
      <li><a href="#animated">Animated projections over time</a></li>
      <li><a href="#auckland-vs-others"><i>R</i><sub>eff</sub> in Auckland vs rest of NZ</a></li>
      <li><a href="#disclaimer">Disclaimer on trends</a></li>
      <li><a href="#methodology">Methodology</a></li>
      <li><a href="#details">Data sources and contact</a></li>
    </div>

    <h3 id="all"><i>R</i><sub>eff</sub> estimate from all cases</h3>

    <p>
      New Zealand is currently experiencing an outbreak of COVID, due to the delta
      variant. On August 17th, Auckland entered lockdown restrictions under Alert Level
      4. Since then restrictions have been loosened to Alert Level 3, and further
      loosened under "Phase 1" of a reopening plan. Restrictions have since been
      loosened.
    </p>
    <p>
      How have restrictions in New Zealand affected the spread of the virus? The below
      plot shows how the effective reproduction number of the virus,
      <i>R</i><sub>eff</sub> has changed over time in New Zealand, as well as how
      the daily cases have changed over time. A trendline shows the approximate
      trajectory daily case numbers would follow, were the reproduction number of the
      virus to remain at its current level.
    </p>
    <p>
      The same plot is shown twice, the first with cases on a linear scale, and the
      second on a log scale‚Äîthe latter showing how consistently the caseload has
      followed exponential growth (which forms a straight line on a log scale).
    </p>
    <img src="COVID_NZ_linear.svg">
    <img src="COVID_NZ.svg">

    <h3 id="sir">SIR model projection</h3>
    <p>
      The trendlines in the above plots simply project forward case numbers assuming that
      <i>R</i><sub>eff</sub> remains at its current estimated value. What about the
      effect of built-up immunity? Below is a plot with the projected trend taking into
      account an estimated reduction of spread due to increasing immunity from
      infections, which slows transmission once a non-negligible fraction of the
      population has been infected. The projection assumes that only 20% of infections
      are captured by testing, as such, for every projected case there are an additional
      four infections implied that are not detected through testing.
    </p>
    <p>
      This projection shows what might be possible if all other factors affecting
      <i>R</i><sub>eff</sub>‚Äîsuch as restrictions‚Äîare held constant.
    </p>
    <p>
      As of December 2021, this model's projections do not differ much from a simple
      exponential trend. Previously it differed in that it predicted a peak once a
      sufficient vaccination coverage level was reached, and in the future it may differ
      again if the omicron variant begins spreading in New Zealand.
    </p>
    <p>
      The same plot is shown twice, the first with cases on a linear scale, and the
      second on a log scale.
    </p>
    <img src="COVID_NZ_vax_linear.svg">
    <img src="COVID_NZ_vax.svg">

    <h3 id="animated">Animated projections over time</h3>

    <p>
    How have the above projections changed over time? Below are animated versions of
    previous projections, one with cases on a linear scale, and one with cases on a log
    scale, run on old data to show how the projections have changed over time. Note that
    these are not 100% identical to the projections actually made on previous days, as
    there have been some slight methodology changes‚Äîbut they should be very close.
    </p>
    <p>
    Note that previously, the main factor affecting these projections was an estimated
    reduction in the rate of spread due to vaccines. The model is still the same, but
    there is no longer any expected future effect from increasing vaccines, as the 1st
    and 2nd dose rollout is mostly complete. are not taken into account in the model. If
    the 3rd dose rollout looks to plausibly make a difference to the spread of omicron
    in New Zealand, if and when omicron arrives in New Zealand, then I will add their
    effect to the model.
    </p>

    <video width=900 controls loop><source src="nz_animated_linear.webm" type="video/webm"></video>
    <video width=900 controls loop><source src="nz_animated.webm" type="video/webm"></video>

    <h3 id="auckland-vs-others"><i>R</i><sub>eff</sub> in Auckland vs rest of NZ</h3>
    <p>
      Below are two plots showing case numbers and an estimated <i>R</i><sub>eff</sub>
      value in Auckland (the Auckland, Counties Manukau, and WaitematƒÅ DHBs), and the
      rest of New Zealand <i>excluding</i> Auckland.
    </p>
    <p>
      Note: case numbers on these plots are shown on a log scale.
    </p>
    <img src="COVID_NZ_auckland.svg">
    <img src="COVID_NZ_notauckland.svg">

    <h3 id="disclaimer">Disclaimer on trends</h3>
    <p>
      The plotted exponential trendlines in the above plots are simple extrapolations of
      what will happen if <i>R</i><sub>eff</sub> remains at its current value. the SIR
      model projection, although it accounts for the effect of increasing immunity,
      still assumes that <i>R</i><sub>eff</sub> otherwise remains constant.
    </p>  
    <p> 
      This does not take into account that things are in a state of flux. If
      restrictions are tightened, the virus should have fewer opportunities for spread,
      and <i>R</i><sub>eff</sub> will decrease. If restrictions are eased, it may
      increase. Contact tracing may suppress spread to a greater or lesser degree over
      time. The above plots specifically showing the effect of population immunity do
      take into account a reduction in <i>R</i><sub>eff</sub> as immunity due to
      infections increases, but ignores any other possible future changes in
      <i>R</i><sub>eff</sub>.
    </p>
    <p>
      Furthermore, when case numbers are small, the random chance of how many people
      each infected person subsequently infects can cause estimates of
      <i>R</i><sub>eff</sub> to vary randomly in time. As such the projections should be
      taken with a grain of salt‚Äîit is merely an indication of the trend as it is right
      now.
    </p> 

  <h3 id="methodology">Methodology</h3>

  <h4>Padding, smoothing, and calculating <i>R</i><sub>eff</sub></h4>

  <p>
    Before calculating <i>R</i><sub>eff</sub>, the daily case numbers are padded on the
    right and smoothed. A symmetric smoothing method is used, which is why padding on the
    right is necessary before smoothing.
  </p>
  <p>
    The padding is an extrapolation based on a fit to the most recent 14 days of daily
    case numbers <i>n</i>(<i>t</i>), with the following fit function:
  </p>
  <p>
    <i>n</i>(<i>t</i>) = <i>A</i> exp[
    <i>k</i>(
    <i>t</i>-<i>t</i><sub>today</sub>)
    + 1/2 <i>kÃá</i> (<i>t</i>-<i>t</i><sub>today</sub>
    )<sup>2</sup>
    ]
  </p>
  <p>
    where <i>A</i> and <i>k</i> are the fit parameters for the current daily caseload
    and exponential growth rate, and <i>kÃá</i> is the current expected rate of change of
    the exponential growth rate due to vaccines:
  </p>
  <p>
    <i>kÃá</i> = 1 / ùúè (<i>s</i><sub>vax</sub>(<i>t</i><sub>today</sub>) /
    <i>s</i><sub>vax</sub>(<i>t</i><sub>yesterday</sub>) - 1)
  </p>
  <p>
    where ùúè = 5 days is the approximate mean generation time of the virus, and
    <i>s</i><sub>vax</sub>(<i>t</i><sub>today</sub>) and
    <i>s</i><sub>vax</sub>(<i>t</i><sub>yesterday</sub>) are the fraction of the
    population not protected by vaccination from infection today and yesterday. See <a
    href="#vax-assumptions">vaccination assumptions</a> below for how
    <i>s</i><sub>vax</sub>(<i>t</i>) is calculated from vaccination numbers.
  </p>
  <p>
    After padding, the daily case numbers‚Äîafter adding an offset and taking their log‚Äî
    are smoothed with 4-day Gaussian smoothing. The result is then exponentiated and the
    offset subtracted off again to obtain smoothed daily case numbers. This is a
    compromise between ordinary Gaussian smoothing for small case numbers, and Gaussian
    smoothing in log space for larger case numbers.
  </p>
  <p>
    log(<i>n</i><sub>smoothed</sub>(<i>t</i>)+10) = log(<i>n</i>(<i>t</i>)+10) ‚àó
    (2ùúã<i>T</i><sub>s</sub><sup>2</sup>)<sup>-1/2</sup> exp(-<i>t</i><sup>2</sup> /
    2<i>T</i><sub>s</sub><sup>2</sup>)
  </p>
  <p>
    where <i>T</i><sub>s</sub> = 4 days and ‚àó is the convolution operation.
  </p>
  </p>
  <p>
    <i>R</i><sub>eff</sub> is then calculated for each day as:
  </p>
  <p>
    <i>R</i><sub>eff</sub>(<i>t<sub>i</sub></i>) =
    (<i>n</i><sub>smoothed</sub>(<i>t<sub>i</sub></i>) /
    <i>n</i><sub>smoothed</sub>(<i>t</i><sub><i>i</i>-1</sub>))<sup>ùúè</sup>.
  </p>
  <p>
    The uncertainty in <i>R</i><sub>eff</sub> has contributions from the uncertainty in
    the above-mentioned fit, as well as uncertainty in daily case numbers. The latter is
    considered to be Poisson noise scaled by a constant, chosen so as to make the
    reduced chi squared between raw and smoothed daily case numbers equal to 1.0.
  </p>

  <h4>Trend based on <i>R</i><sub>eff</sub> only</h4>

  <p>
    The plot(s) with a simple exponential extrapolation of daily case numbers, without
    taking into account the expected effects of vaccines or population immunity, is
    exponential growth/decay using the most recent value of <i>R</i><sub>eff</sub> and
    its uncertainty range:
  </p>
  <p>
    <i>n</i><sub>extrap</sub> (<i>t<sub>i</sub></i>) =
    <i>n</i><sub>smoothed</sub>(<i>t</i><sub>today</sub>)
    <i>R</i><sub>eff</sub>(<i>t</i><sub>today</sub>)
    <sup>(<i>t<sub>i</sub></i> - <i>t</i><sub>today</sub>) / ùúè</sup>
  </p>

  <h4>SIR model with projected effect of vaccines</h4>
  <p>
    To project the effect of vaccines and community immunity on the progression of daily
    cases in the future, I use a stochastic SIR model. The model is run 1000 times to
    project daily case numbers, and the median result and 68% range of outcomes shown in
    the projection.
  </p>
  <p>
    In each run of the model, a random value for each of
    <i>R</i><sub>eff</sub>(<i>t</i><sub>today</sub>) and
    <i>n</i><sub>smoothed</sub>(<i>t</i><sub>today</sub>) is drawn from a multivariate
    normal distribution, using the mean values and covariance of the estimates of the two
    parameters.
  </p>
  <p>
    The initial infectious population is taken to be:
  </p>
  <p>
    <i>i</i>(<i>t</i><sub>today</sub>) =
    ùúè <i>n</i><sub>smoothed</sub>(<i>t</i><sub>today</sub>)
  </p>
  <p>
    The initial recovered population <i>r</i>(<i>t</i><sub>today</sub>) is taken to be the
    cumulative number of cases so far in the outbreak, minus the currently infectious
    population.
  </p>
  <p>
    Each day, the fraction of the population susceptible to infection <i>s</i>(<i>t</i>) is
    taken to be
  </p>
  <p>
    <i>s</i>(<i>t</i>) = <i>s</i><sub>vax</sub>(<i>t</i>) [1 - (<i>r</i>(<i>t</i>) +
    <i>i</i>(<i>t</i>)) / <i>N</i>]
  </p>
  <p>
    where <i>s</i><sub>vax</sub>(<i>t</i>) is the fraction of the population not
    protected from infection by vaccines (see See <a href="#vax-assumptions">below</a>
    for how this is calculated), and <i>N</i> is the total population multiplied by the
    fraction of infections assumed to come forward for testing (20%).
  </p>
  <p>
    Assuming that <i>R</i><sub>eff</sub> is proportional to the susceptible fraction of
    the population, we can estimate what the reproduction number of the virus would be
    in the absence of any vaccines or immunity from infection:
  </p>
  <p>
    <i>R</i><sub>naive</sub> = <i>R</i><sub>eff</sub>(<i>t</i><sub>today</sub>) /
    <i>s</i>(<i>t</i><sub>today</sub>)
  </p>
  <p>
    And compute an <i>R</i><sub>eff</sub> for each future day based on the susceptible
    fraction of the population that day:
  </p>
  <p>
    <i>R</i><sub>eff</sub>(<i>t</i>) = <i>s</i>(<i>t</i>) <i>R</i><sub>naive</sub>
  </p>
  <p>
    Each day of the model, the infectious population is increased by the number of new
    infections, and decreased by the number of new recoveries. The recovered population is
    increased by the number of new recoveries.
  </p>
  <p>
    The number of new infections each day is drawn from a Poission distribution with mean
    equal to <i>i</i>(<i>t</i>) <i>R</i><sub>eff</sub>(<i>t</i>) / ùúè.
  </p>
  <p>
    The number of new recoveries each days is drawn from a binomial distribution with
    number of trials equal to the infectious population <i>i</i>(<i>t</i>), and with
    probability 1 / ùúè.
  </p>
  <h4 id="vax-assumptions">Vaccination assumptions</h4>
  <p>
    To model vaccines taking effect after a delay, daily vaccine dose numbers
    <i>v</i>(<i>t</i>) are convolved with a Gaussian function offset 1.5 weeks in the
    future, with standard deviation 0.5 weeks:
  </p>
  <p>
    <i>v</i><sub>effective</sub>(<i>t</i>) = <i>v</i>(<i>t</i>) ‚àó
    (2ùúã<i>œÉ</i><sup>2</sup>)<sup>-1/2</sup> exp(-(<i>t</i> - <i>Œº</i>)<sup>2</sup> /
    2<i>œÉ</i><sup>2</sup>)
  </p>
  <p>
    where <i>Œº</i> = 10.5 days, <i>œÉ</i> = 3.5 days, and ‚àó is the convolution
    operation. This causes the effect of a vaccine dose to over the course of the
    second week after it is adminsitered, reaching nearly full effectiveness
    approximately two weeks after administration.
  </p>
  <p>
    I assume that one dose of any vaccine reduces spread by 40%, and two doses reduce
    spread by 80%. The proportion of the population not protected by the vaccine against
    infection is then:
  </p>
  <p>
    <i>s</i><sub>vax</sub>(<i>t<sub>i</sub></i>) = 1 - 0.4 √ó <i>d</i>(<i>t</i><sub><i>i</i></sub>)
  </p>
  <p>
    where <i>d</i>(<i>t</i><sub><i>i</i></sub>) is the cumulative number of doses per
    capita on each day.
  </p>
  <p>
    As of Dec 2021, these vaccine assumptions are not particularly relevant to the
    projections, as the 1st and 2nd dose rollouts are mostly complete, and omicron
    likely escapes most vaccine-induced immunity against infection in any case. I am not
    yet including a modelled effect of 3rd doses, but may do so if the omicron waves
    last long enough for it to plausibly make a difference to spread, or if 3rd doses
    are brought forward in time.
  </p>

    <h3 id="details">Data sources and contact</h3>

    <p>
      Source for case numbers:
      <a href="https://www.health.govt.nz/our-work/diseases-and-conditions/covid-19-novel-coronavirus/covid-19-data-and-statistics/covid-19-case-demographics">New Zealand Ministry of Health</a>
    </p>
    <p>
      Plots/analysis by Chris Billington. Contact: chrisjbillington [at] gmail [dot] com
    </p>
    <p>
      Python script for producing the plots can be found at <a href="https://github.com/chrisjbillington/chrisjbillington.github.io/blob/master/nz.py">GitHub</a>.
    </p>
  </div>
</body>
</html>
